# HakoSpace-releases — Push Rules

> **Audience**: LLM agents (primary), human maintainers, and anyone with push access to this repository.
>
> **Purpose**: This repository is the **shipping room** for HakoSpace releases. The source of truth for all code lives in the Agora repository. This repo contains only release artifacts, legal documents, and documentation.

---

## 1. Language

All content pushed to this repository **must be in English**. This includes:

- Commit messages
- Tag annotations
- CHANGELOG.md entries
- Pull request descriptions (if any)
- Documentation and comments

**Exception**: The bilingual note block in README.md (Beta signing notice) is grandfathered in.

---

## 2. Repository Roles

| Repository | Role | Contains |
|---|---|---|
| **Agora** (private) | Source of truth | All source code, build scripts, VERSION file, legal doc originals |
| **HakoSpace-releases** (public) | Shipping room | Release binaries, checksums, changelogs, legal doc copies, README |

- Legal documents (LICENSE, EULA.md, PRIVACY.md) originate in Agora and are copied here.
- Never edit legal documents directly in this repo — sync from Agora.
- README.md is maintained directly in this repo.

---

## 3. Directory Structure

```
HakoSpace-releases/
├── README.md                    # Public-facing project page
├── LICENSE                      # Community Edition license (synced from Agora)
├── EULA.md                      # End User License Agreement (synced from Agora)
├── PRIVACY.md                   # Privacy Policy (synced from Agora)
├── CONTRIBUTING.md              # This file — push rules
└── releases/
    └── {VERSION}/               # e.g. B1.0/
        ├── hako-linux-amd64     # Server binary
        ├── HakoSpace-*.AppImage # Desktop client (Linux)
        ├── HakoSpace-*.exe      # Desktop client (Windows)
        ├── CHANGELOG.md         # Auto-generated by release.sh
        └── SHA256SUMS.txt       # Auto-generated by release.sh
```

---

## 4. Commit Message Format

```
{type}: {short English description}
```

**Types** (lowercase):

| Type | When to use |
|---|---|
| `release` | Adding release artifacts for a version |
| `docs` | README or CONTRIBUTING changes |
| `legal` | LICENSE, EULA.md, or PRIVACY.md updates |
| `fix` | Correcting a previous release entry (e.g. wrong checksum) |
| `chore` | Housekeeping (gitignore, CI config, etc.) |

**Examples**:
```
release: B1.0
release: B1.1
docs: update Quick Start section
legal: sync EULA from Agora (added arbitration clause)
fix: regenerate B1.0 checksums
```

---

## 5. Release Push Workflow

### Step 1 — Build (Agora repo)

Run `release.sh` from the Agora repository. It produces all artifacts into `releases/{VERSION}/`.

```bash
# From Agora repo root
bash scripts/release.sh
```

### Step 2 — Human Review

The repository owner reviews the output:
- Binaries exist and are non-zero size
- `SHA256SUMS.txt` covers all binary files
- `CHANGELOG.md` is present and accurate

**No push happens until the owner explicitly approves.**

### Step 3 — Commit and Tag

Once approved, the designated pusher (LLM agent or maintainer) executes:

```bash
cd /path/to/HakoSpace-releases
git add -A
git commit -m "release: {VERSION}"
git tag {VERSION}
```

### Step 4 — Push

```bash
git push origin main --tags
```

### Step 5 — Create GitHub Release

```bash
gh release create {VERSION} releases/{VERSION}/* \
  --title "HakoSpace {VERSION}" \
  --notes-file releases/{VERSION}/CHANGELOG.md
```

---

## 6. Tag Format

- Tags are the version string from the `VERSION` file **verbatim** (e.g. `B1.0`, `B1.1`).
- **No `v` prefix.** The version format already includes its own identifier.
- Tags are **immutable** — never delete or force-push a tag.
- One tag per release, matching the `releases/{VERSION}/` directory name exactly.

---

## 7. Allowed and Forbidden Content

### Allowed

- Release binaries produced by `release.sh`
- `SHA256SUMS.txt` (auto-generated by `release.sh`)
- `CHANGELOG.md` (auto-generated by `release.sh`)
- Legal documents synced from Agora (LICENSE, EULA.md, PRIVACY.md)
- README.md and CONTRIBUTING.md edits

### Forbidden

- Source code of any kind (Go, TypeScript, HTML, CSS, etc.)
- API keys, tokens, secrets, credentials, `.env` files
- Debug or development builds
- Files not produced by the release pipeline
- Unsigned or unverified binaries (must come from `release.sh`)
- Binary files outside of a `releases/{VERSION}/` directory

---

## 8. Legal Document Sync Rules

1. Legal documents (LICENSE, EULA.md, PRIVACY.md) are authored and maintained in the **Agora** repository.
2. When legal docs change in Agora, copy them to this repo in a **separate commit**.
3. Use commit type `legal` (e.g. `legal: sync EULA from Agora`).
4. **Never** bundle legal doc changes with release artifact commits.
5. **Never** edit legal documents directly in this repo.

---

## 9. Pre-Push Checklist

Before every push, verify:

- [ ] All files in `releases/{VERSION}/` were produced by `release.sh`
- [ ] `SHA256SUMS.txt` exists and covers every binary in the release directory
- [ ] `CHANGELOG.md` is present and non-empty
- [ ] No source code, secrets, or debug builds in the commit
- [ ] Commit message follows the format in Section 4
- [ ] Tag matches the VERSION file and the directory name exactly
- [ ] Owner has explicitly approved the release

---

## 10. Branch Strategy

- **`main` is the only branch.** All pushes go directly to `main`.
- No feature branches, no pull requests — this is an artifact repository.
- Force-push to `main` is **forbidden**.

---

## 11. Hotfix / Correction Procedure

If a released version needs correction (e.g. wrong binary, missing file):

1. Fix the files in `releases/{VERSION}/`
2. Regenerate `SHA256SUMS.txt`
3. Commit with `fix: {description}` (e.g. `fix: regenerate B1.0 checksums`)
4. **Do not** create a new tag — the existing tag remains
5. Update the GitHub Release if binary attachments changed

---

*Last updated: 2026-02-28*
